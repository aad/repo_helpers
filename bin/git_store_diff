#!/bin/bash

: ${GIT_PATCHES_DIR:="$HOME/git_patches"}

if [[ -n "$@" ]];then
  DESCRIPTION="_$(echo "$@" | sed 's/ /_/g')"
fi

CURRENT_DATE=$(date +%F)
CURRENT_TIME=$(date +%FT%H-%M)
HEAD_ID=$(git rev-parse --short HEAD)
FILE_PATH=$GIT_PATCHES_DIR$(pwd)/${CURRENT_DATE}_${HEAD_ID}

mkdir -p ${FILE_PATH}

FILE_NAME=${FILE_PATH}/${CURRENT_TIME}${DESCRIPTION}

for i in {1..5}; do 
  if [[ -e "${FILE_NAME}" ]]; then
    FILE_NAME="${FILE_NAME}_a"
  fi
done

if [[ -e "${FILE_NAME}" ]]; then
  echo "file exits already: ${FILE_NAME}"
  exit 1
fi

# git add -A

# committed changes
git diff --cached > ${FILE_NAME}

# uncommitted changes
git diff >> ${FILE_NAME}

